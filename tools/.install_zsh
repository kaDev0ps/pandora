#!/bin/bash
set -e

# Install necessary packages
apt-get update && apt-get install git zsh -y

# Try to install powerline and fonts-powerline, continue without them if it fails
if ! apt-get install powerline fonts-powerline -y; then
  echo "Installation of powerline and fonts-powerline failed. Continuing without them."
fi

# Clone Oh My Zsh repository
git clone https://github.com/robbyrussell/oh-my-zsh.git ~/.oh-my-zsh
cp ~/.oh-my-zsh/templates/zshrc.zsh-template ~/.zshrc
sed -i 's/^ZSH_THEME=".*"/ZSH_THEME="jonathan"/' ~/.zshrc

# Clone additional plugins
git clone https://github.com/zsh-users/zsh-syntax-highlighting.git "$HOME/.zsh-syntax-highlighting" --depth 1
echo "source $HOME/.zsh-syntax-highlighting/zsh-syntax-highlighting.zsh" >> "$HOME/.zshrc"
git clone https://github.com/zsh-users/zsh-autosuggestions ~/.oh-my-zsh/custom/plugins/zsh-autosuggestions
sed -i 's/^plugins=(git)$/plugins=(git zsh-autosuggestions)/' ~/.zshrc
echo "ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE='fg=blue,bold'" >> ~/.zshrc   

echo "setopt extended_history
HIST_STAMPS=\"yyyy-mm-dd hh:mm:ss\"
alias history=\"fc -l -i\"" >> ~/.zshrc

zsh -c "source $HOME/.zshrc"
chsh -s /bin/zsh $USER
# User instructions
echo "Installation finished SUCCESS"
wget https://raw.githubusercontent.com/kaDev0ps/pandora/main/tools/.bash_alias -O ~/.bash_aliases && echo "if [ -f ~/.bash_aliases ]; then . ~/.bash_aliases; fi" >> ~/.bashrc && echo "if [ -f ~/.bash_aliases ]; then source ~/.bash_aliases; fi" >> ~/.zshrc && zsh
echo "Aliases added SUCCESS"
